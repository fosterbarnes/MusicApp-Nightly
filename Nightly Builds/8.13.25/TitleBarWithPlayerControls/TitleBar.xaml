<UserControl x:Class="MusicApp.TitleBarWithPlayerControls.TitleBar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:MusicApp.TitleBarWithPlayerControls"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:MusicApp.Converters"
             mc:Ignorable="d"
             Height="85" 
             Background="#1E1E1E"
             MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <!-- Converters -->
            <converters:SliderValueToWidthMultiConverter x:Key="SliderValueToWidthMultiConverter"/>
            
            <!-- Custom Button Style for Media Controls -->
            <Style x:Key="CustomMediaButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Width" Value="48"/>
                <Setter Property="Height" Value="48"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="24"
                                    Width="{TemplateBinding Width}"
                                    Height="{TemplateBinding Height}">
                                <Grid>
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Panel.ZIndex="2"/>
                                    <Ellipse x:Name="Ripple" Fill="#705399" Opacity="0" Width="48" Height="48" 
                                            HorizontalAlignment="Center" VerticalAlignment="Center" Panel.ZIndex="1">
                                        <Ellipse.RenderTransform>
                                            <ScaleTransform x:Name="RippleScale" ScaleX="0" ScaleY="0" CenterX="24" CenterY="24"/>
                                        </Ellipse.RenderTransform>
                                    </Ellipse>
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <EventTrigger RoutedEvent="Button.PreviewMouseDown">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="Ripple" 
                                                             Storyboard.TargetProperty="Opacity" 
                                                             To="0.3" Duration="0:0:0.15"/>
                                            <DoubleAnimation Storyboard.TargetName="RippleScale" 
                                                             Storyboard.TargetProperty="ScaleX" 
                                                             To="1" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="RippleScale" 
                                                             Storyboard.TargetProperty="ScaleY" 
                                                             To="1" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="Ripple" 
                                                             Storyboard.TargetProperty="Opacity" 
                                                             To="0" Duration="0:0:0.2" BeginTime="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="RippleScale" 
                                                             Storyboard.TargetProperty="ScaleX" 
                                                             To="0" Duration="0:0:0.1" BeginTime="0:0:0.4"/>
                                            <DoubleAnimation Storyboard.TargetName="RippleScale" 
                                                             Storyboard.TargetProperty="ScaleY" 
                                                             To="0" Duration="0:0:0.1" BeginTime="0:0:0.4"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2D2D2D"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Custom Volume Slider Style -->
            <Style x:Key="CustomVolumeSlider" TargetType="Slider">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Slider">
                            <Grid>
                                <!-- Background Track -->
                                <Border Height="4" Background="#404040" VerticalAlignment="Center" CornerRadius="2"/>
                                
                                <!-- Filled Portion -->
                                <Border Height="4" Background="#705399" VerticalAlignment="Center" CornerRadius="2" 
                                        HorizontalAlignment="Left">
                                    <Border.Width>
                                        <MultiBinding Converter="{StaticResource SliderValueToWidthMultiConverter}">
                                            <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="Value"/>
                                            <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="Maximum"/>
                                            <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="ActualWidth"/>
                                        </MultiBinding>
                                    </Border.Width>
                                </Border>
                                
                                <!-- Slider Track for Interaction -->
                                <Track x:Name="PART_Track">
                                    <Track.DecreaseRepeatButton>
                                        <RepeatButton Command="Slider.DecreaseLarge" Opacity="0" Focusable="false"/>
                                    </Track.DecreaseRepeatButton>
                                    <Track.IncreaseRepeatButton>
                                        <RepeatButton Command="Slider.IncreaseLarge" Opacity="0" Focusable="false"/>
                                    </Track.IncreaseRepeatButton>
                                    <Track.Thumb>
                                        <Thumb x:Name="Thumb" Background="#705399">
                                            <Thumb.Template>
                                                <ControlTemplate TargetType="Thumb">
                                                    <Ellipse Fill="#705399" Width="20" Height="20"/>
                                                </ControlTemplate>
                                            </Thumb.Template>
                                        </Thumb>
                                    </Track.Thumb>
                                </Track>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Window Control Button Style -->
            <Style x:Key="WindowControlButton" TargetType="Button">
                <Setter Property="Width" Value="36"/>
                <Setter Property="Height" Value="30"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Cursor" Value="Arrow"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#505050"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Close Button Style (with red hover effect) -->
            <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButton}">
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#E81123"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <!-- ===========================================
         TITLE BAR SECTION
         Contains: Playback Controls, Volume Controls, Song Info, Window Controls
         =========================================== -->
    <Border Background="#1E1E1E" 
            VerticalAlignment="Top">
        <Grid>
            <!-- Title Bar Grid Definitions -->
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>  <!-- Playback Controls -->
                <ColumnDefinition Width="Auto"/>  <!-- Volume Controls -->
                <ColumnDefinition Width="*"/>     <!-- Spacer -->
                <ColumnDefinition Width="Auto"/>  <!-- Window Controls -->
            </Grid.ColumnDefinitions>

            <!-- ===========================================
                 PLAYBACK CONTROLS SECTION
                 =========================================== -->
            <StackPanel Grid.Column="0" 
                        Orientation="Horizontal" 
                        VerticalAlignment="Center" 
                        Margin="20,15,0,10">
                
                <!-- Previous Track Button -->
                <Button x:Name="btnPrevious" 
                        Style="{StaticResource CustomMediaButton}" 
                        Foreground="White" 
                        Margin="0,0" 
                        Click="BtnPrevious_Click">
                    <materialDesign:PackIcon Kind="SkipPrevious" Width="24" Height="24"/>
                </Button>
                
                <!-- Play/Pause Button -->
                <Button x:Name="btnPlayPause" 
                        Style="{StaticResource CustomMediaButton}" 
                        Foreground="White"  
                        Margin="2,0" 
                        Click="BtnPlayPause_Click">
                    <materialDesign:PackIcon x:Name="iconPlayPause" Kind="Play" Width="24" Height="24"/>
                </Button>
                
                <!-- Next Track Button -->
                <Button x:Name="btnNext" 
                        Style="{StaticResource CustomMediaButton}" 
                        Foreground="White" 
                        Margin="0,0" 
                        Click="BtnNext_Click">
                    <materialDesign:PackIcon Kind="SkipNext" Width="24" Height="24"/>
                </Button>
            </StackPanel>

            <!-- ===========================================
                 VOLUME CONTROLS SECTION
                 =========================================== -->
            <StackPanel Grid.Column="1" 
                        Orientation="Horizontal" 
                        VerticalAlignment="Center" 
                        Margin="30,15,0,10">
                
                <!-- Volume Slider -->
                <Slider x:Name="sliderVolume" 
                        Width="100" 
                        Minimum="0" 
                        Maximum="100" 
                        Value="100" 
                        VerticalAlignment="Center" 
                        ValueChanged="SliderVolume_ValueChanged"
                        Style="{StaticResource CustomVolumeSlider}"
                        Foreground="#705399" 
                        Background="Transparent"/>
                
                <!-- Volume Icon Button -->
                <Border Background="Transparent" 
                        Padding="8" 
                        VerticalAlignment="Center" 
                        Margin="5,0,0,0" 
                        MouseLeftButtonDown="IconVolume_MouseLeftButtonDown">
                    <materialDesign:PackIcon x:Name="iconVolume" Kind="VolumeHigh" Foreground="White"/>
                </Border>
            </StackPanel>

            <!-- ===========================================
                 WINDOW CONTROLS SECTION
                 =========================================== -->
            <StackPanel Grid.Column="3" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        VerticalAlignment="Top">
                
                <!-- Minimize Button -->
                <Button x:Name="btnMinimize" 
                        Style="{StaticResource WindowControlButton}"
                        Click="BtnMinimize_Click">
                    <materialDesign:PackIcon Kind="WindowMinimize" Width="16" Height="16"/>
                </Button>
                
                <!-- Maximize/Restore Button -->
                <Button x:Name="btnMaximize" 
                        Style="{StaticResource WindowControlButton}"
                        Click="BtnMaximize_Click">
                    <materialDesign:PackIcon x:Name="iconMaximize" Kind="WindowMaximize" Width="16" Height="16"/>
                </Button>
                
                <!-- Close Button -->
                <Button x:Name="btnClose" 
                        Style="{StaticResource CloseButtonStyle}"
                        Click="BtnClose_Click">
                    <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                </Button>
            </StackPanel>

            <!-- ===========================================
                 CURRENT SONG INFO SECTION (Overlay - Centered across entire window)
                 =========================================== -->
            <Border x:Name="songInfoBorder"
                    Grid.ColumnSpan="4"
                    Background="#0A0A0A" 
                    CornerRadius="8" 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Padding="15,10"
                    Margin="0,0,0,0"
                    Panel.ZIndex="1">
                <Grid VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>  <!-- Album Art -->
                        <ColumnDefinition Width="*"/>     <!-- Song Info (fills available space) -->
                    </Grid.ColumnDefinitions>
                    
                    <!-- Album Art Container -->
                    <Border Grid.Column="0"
                            Width="50" 
                            Height="50" 
                            Background="#404040" 
                            
                            CornerRadius="5" 
                            Margin="0,0,15,0">
                        <Border.Clip>
                            <RectangleGeometry Rect="0,0,50,50" RadiusX="5" RadiusY="5"/>
                        </Border.Clip>
                        <Image x:Name="imgAlbumArt" Stretch="UniformToFill"/>
                    </Border>
                    
                    <!-- Song Information -->
                    <Grid Grid.Column="1" VerticalAlignment="Center">
                        <!-- Song Title and Artist -->
                        <StackPanel VerticalAlignment="Center" Margin="0,0,0,19">
                            <TextBlock x:Name="txtCurrentTrack" 
                                       Text="No track selected" 
                                       Foreground="White" 
                                       FontWeight="Bold" 
                                       FontSize="14"/>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,-1">
                                <TextBlock x:Name="txtCurrentArtist" 
                                           Text="" 
                                           Foreground="#CCCCCC" 
                                           FontSize="12"/>
                                <TextBlock x:Name="txtDashSeparator" 
                                           Text=" - " 
                                           Foreground="#CCCCCC" 
                                           FontSize="12"
                                           Margin="5,0,5,0"
                                           Visibility="Collapsed"/>
                                <TextBlock x:Name="txtCurrentAlbum" 
                                           Text="" 
                                           Foreground="#CCCCCC" 
                                           FontSize="12"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Gradient Mask to prevent text from extending under shuffle/repeat buttons -->
                    <Rectangle x:Name="textGradientMask"
                              Grid.Column="1"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Top"
                              Width="125"
                              Height="38"
                              Margin="0,0,0,0"
                              Panel.ZIndex="0">
                        <Rectangle.Fill>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#000A0A0A" Offset="0.0"/>    <!-- Transparent starts here -->
                                <GradientStop Color="#000A0A0A" Offset="0.48"/>    <!-- Still transparent -->
                                <GradientStop Color="#FF0A0A0A" Offset="0.68"/>   <!-- Starts becoming opaque immediately -->
                                <GradientStop Color="#FF0A0A0A" Offset="0.9"/>    <!-- Fully opaque -->
                            </LinearGradientBrush>
                        </Rectangle.Fill>
                    </Rectangle>
                    
                    <!-- Small solid rectangle to cover the 1-pixel gap -->
                    <Rectangle x:Name="gapCoverRectangle"
                              Grid.Column="1"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Top"
                              Width="5"
                              Height="38"
                              Margin="0,0,-4,0"
                              Panel.ZIndex="0"
                              Fill="#0A0A0A"/>
                    
                    <!-- Queue Button - Positioned outside and to the right of the currently playing section -->
                    <Border x:Name="btnQueue" 
                            Grid.Column="1"
                            Width="35" 
                            Height="24" 
                            Background="#717171" 
                            BorderThickness="1"
                            BorderBrush="#434242"
                            CornerRadius="3"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Margin="0,0,-95,0"
                            Panel.ZIndex="1"
                            MouseLeftButtonDown="BtnQueue_Click"
                            MouseLeftButtonUp="BtnQueue_MouseLeftButtonUp"
                            Cursor="Arrow"
                            RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform x:Name="btnQueueTransform" ScaleX="1" ScaleY="1"/>
                        </Border.RenderTransform>
                        <Image Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Image.Source>
                                <StaticResource ResourceKey="di_queue"/>
                            </Image.Source>
                        </Image>
                    </Border>
                    
                    <!-- Seek Bar - Now a direct child of the main Grid -->
                    <Grid Grid.Column="1" VerticalAlignment="Center" Margin="0,36,39,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>  <!-- Current Time -->
                            <ColumnDefinition Width="*"/>     <!-- Progress Bar (fills available space) -->
                            <ColumnDefinition Width="Auto"/>  <!-- Total Duration -->
                        </Grid.ColumnDefinitions>
                        
                        <!-- Current Time -->
                        <TextBlock x:Name="txtCurrentTime" 
                                   Grid.Column="0"
                                   Text="0:00" 
                                   Foreground="#CCCCCC" 
                                   FontSize="11" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,8,-7"/>
                        
                        <!-- Progress Bar -->
                        <Border Grid.Column="1"
                                Height="4" 
                                Background="#404040" 
                                CornerRadius="2" 
                                VerticalAlignment="Center"
                                Margin="0,2,0,-7"
                                x:Name="seekBarBackground"
                                MouseLeftButtonDown="SeekBar_MouseLeftButtonDown"
                                MouseMove="SeekBar_MouseMove"
                                MouseLeftButtonUp="SeekBar_MouseLeftButtonUp"
                                MouseLeave="SeekBar_MouseLeave"
                                Cursor="Hand">
                            <Border x:Name="progressFill" 
                                    Background="White" 
                                    HorizontalAlignment="Left" 
                                    Width="0"/>
                        </Border>
                        
                        <!-- Extended Clickable Area (Invisible) -->
                        <Border Grid.Column="1"
                                Height="20"
                                Background="Transparent"
                                VerticalAlignment="Center"
                                x:Name="seekBarExtendedArea"
                                MouseLeftButtonDown="SeekBar_MouseLeftButtonDown"
                                MouseMove="SeekBar_MouseMove"
                                MouseLeftButtonUp="SeekBar_MouseLeftButtonUp"
                                MouseLeave="SeekBar_MouseLeave"
                                Cursor="Hand"
                                Panel.ZIndex="-1"/>
                        
                        <!-- Total Duration -->
                        <TextBlock x:Name="txtTotalDuration" 
                                   Grid.Column="2"
                                   Text="0:00" 
                                   Foreground="#CCCCCC" 
                                   FontSize="11" 
                                   VerticalAlignment="Center" 
                                   Margin="8,0,0,-7"/>
                    </Grid>
                    
                    <!-- Shuffle and Repeat Buttons -->
                    <StackPanel Grid.Column="1" 
                              Orientation="Vertical" 
                              VerticalAlignment="Center" 
                              HorizontalAlignment="Right"
                              Margin="15,0,0,0">
                        <!-- Shuffle Button -->
                        <Border x:Name="btnShuffle" 
                                Width="24" 
                                Height="24" 
                                Background="Transparent" 
                                BorderThickness="0"
                                CornerRadius="3"
                                Margin="0,0,0,4"
                                MouseLeftButtonDown="BtnShuffle_Click"
                                MouseLeftButtonUp="BtnShuffle_MouseLeftButtonUp"
                                MouseMove="BtnShuffle_MouseMove"
                                Cursor="Arrow"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="btnShuffleTransform" ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            
                            <Grid>
                                <!-- Animated background fill -->
                                <Rectangle x:Name="btnShuffleFill" 
                                          Fill="#705399" 
                                          Width="0" 
                                          Height="0" 
                                          HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"
                                          RadiusX="3"
                                          RadiusY="3"/>
                                
                                <materialDesign:PackIcon x:Name="iconShuffle" Kind="ShuffleVariant" Width="16" Height="16" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        
                        <!-- Repeat Button -->
                        <Border x:Name="btnRepeat" 
                                Width="24" 
                                Height="24" 
                                Background="Transparent" 
                                BorderThickness="0"
                                CornerRadius="3"
                                Margin="0,0,0,0"
                                MouseLeftButtonDown="BtnRepeat_Click"
                                MouseLeftButtonUp="BtnRepeat_MouseLeftButtonUp"
                                MouseMove="BtnRepeat_MouseMove"
                                Cursor="Arrow"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="btnRepeatTransform" ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            
                            <Grid>
                                <!-- Animated background fill -->
                                <Rectangle x:Name="btnRepeatFill" 
                                          Fill="#705399" 
                                          Width="0" 
                                          Height="0" 
                                          HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"
                                          RadiusX="3"
                                          RadiusY="3"/>
                                
                                <Image x:Name="iconRepeat" Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                                    <Image.RenderTransform>
                                        <TranslateTransform x:Name="iconRepeatTransform" X="0" Y="0"/>
                                    </Image.RenderTransform>
                                </Image>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>


        </Grid>
    </Border>
</UserControl> 